# Azure Event Grid with private endpoints

This repository is a sample of how to use Azure Event Grid private endpoints with other Azure services that also have private endpoints.

## Rationale

Customers using Azure often want to use the benefits of [platform services](https://learn.microsoft.com/en-us/azure/architecture/guide/design-principles/managed-services) over infrastructure as a service (IaaS) as this allows them to concentrate more on business value, rather than infrastructure management. Increasingly customers also want to lock down these services at a network-level level for security and compliance purposes. [Private endpoints](https://learn.microsoft.com/en-us/azure/private-link/private-endpoint-overview) is the mechanism to do this with platform services. 

Azure [Event Grid](https://learn.microsoft.com/en-us/azure/event-grid/overview) is the Azure platform's message distribution service that may be used to compose architectures that react to events usually generated by Azure services. Most Azure infrastructure generates event grid events and these can be subscribed to by a client to build asynchronous workflows e.g. A function can subscribe to a Storage Account "blob created" event to take action when this happens.

Event Grid supports [private endpoints](https://learn.microsoft.com/en-us/azure/event-grid/configure-private-endpoints). 


## Publish a custom Event Grid Topic

Below is a Python API that may be deployed to an Azure App Service that generates a custom topic event.

```
@app.route('/create_eventgrid_topic', methods=['POST'])
def create_eventgrid_topic():
    topic_name = request.json.get('topic_name')
    resource_group_name = request.json.get('resource_group_name')
    location = request.json.get('location')

    #credential = DefaultAzureCredential(topic_key)
    credential = AzureKeyCredential(topic_key)
    eventgrid_client = EventGridPublisherClient(endpoint, credential)

    event = EventGridEvent(
        subject=topic_name,
        data=request.json,
        event_type="Testing",
        data_version="1.0"
    )

    eventgrid_client.send([event])

    return {"message": "Event sent successfully"}
```
